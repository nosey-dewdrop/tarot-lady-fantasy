<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mystical Tarot Reader</title>
<style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Georgia', serif;
    background: linear-gradient(135deg, #1a1a2e, #16213e, #0f3460);
    color: #fff;
    min-height: 100vh;
    overflow-x: hidden;
    transition: all 0.8s ease;
}

/* Love Theme */
body.love-theme {
    background: linear-gradient(135deg, #ff6b9d, #e91e63, #9c27b0, #673ab7);
    color: #fff;
}

body.love-theme .frame-section {
    background: rgba(255, 105, 180, 0.15);
    border: 1px solid rgba(255, 192, 203, 0.3);
}

body.love-theme .topic-btn.selected {
    background: linear-gradient(145deg, #ff69b4, #ff1493);
    color: #fff;
}

body.love-theme .action-btn {
    background: linear-gradient(145deg, #ff69b4, #e91e63);
}

body.love-theme .interpretation-area {
    border: 2px solid rgba(255, 105, 180, 0.4);
    background: rgba(255, 192, 203, 0.08);
}

body.love-theme .wide-arc-card {
    border-color: #ff69b4;
    color: #ff69b4;
}

body.love-theme .wide-arc-card:hover {
    border-color: #ff1493;
    box-shadow: 0 15px 30px rgba(255, 105, 180, 0.6);
}

body.love-theme .wide-arc-card.selected {
    border-color: #ff1493;
    color: #ff1493;
    box-shadow: 0 0 25px rgba(255, 20, 147, 0.8);
}

body.love-theme .cards-title {
    color: #ff69b4;
}

body.love-theme .star {
    background: #ffb3d9;
}

/* Career Theme */
body.career-theme {
    background: linear-gradient(135deg, #2c3e50, #34495e, #5d4e75, #85144b);
    color: #fff;
}

body.career-theme .frame-section {
    background: rgba(255, 215, 0, 0.1);
    border: 1px solid rgba(255, 215, 0, 0.3);
}

body.career-theme .topic-btn.selected {
    background: linear-gradient(145deg, #ffd700, #ffb300);
    color: #333;
}

body.career-theme .action-btn {
    background: linear-gradient(145deg, #ffd700, #daa520);
    color: #333;
}

body.career-theme .interpretation-area {
    border: 2px solid rgba(255, 215, 0, 0.5);
    background: rgba(255, 215, 0, 0.05);
}

body.career-theme .wide-arc-card {
    border-color: #ffd700;
    color: #ffd700;
}

body.career-theme .wide-arc-card:hover {
    border-color: #ffb300;
    box-shadow: 0 15px 30px rgba(255, 215, 0, 0.6);
}

body.career-theme .wide-arc-card.selected {
    border-color: #ffb300;
    color: #ffb300;
    box-shadow: 0 0 25px rgba(255, 179, 0, 0.8);
}

body.career-theme .cards-title {
    color: #ffd700;
}

body.career-theme .star {
    background: #ffd700;
    box-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
}

.stars {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 1;
}

.star {
    position: absolute;
    background: #fff;
    border-radius: 50%;
    animation: twinkle 3s infinite;
}

@keyframes twinkle {
    0%, 100% { opacity: 0.3; transform: scale(1); }
    50% { opacity: 1; transform: scale(1.2); }
}

@keyframes float {
    0%, 100% { transform: translateY(0px) rotate(0deg); }
    50% { transform: translateY(-20px) rotate(10deg); }
}

@keyframes rotate {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

.container {
    position: relative;
    z-index: 10;
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
}

.header {
    text-align: center;
    margin-bottom: 30px;
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
}

.title {
    font-size: 2.5em;
    background: linear-gradient(45deg, #ffd700, #ff6b6b, #4ecdc4);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    margin-bottom: 10px;
    text-shadow: 0 0 30px rgba(255, 215, 0, 0.3);
    flex: 1;
}

.theme-switcher {
    position: absolute;
    left: 0;
    display: flex;
    gap: 8px;
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(10px);
    border-radius: 25px;
    padding: 5px;
    border: 1px solid rgba(255, 255, 255, 0.2);
}

.theme-btn {
    background: transparent;
    border: none;
    padding: 8px 12px;
    border-radius: 20px;
    cursor: pointer;
    font-size: 1.2em;
    transition: all 0.3s ease;
    color: rgba(255, 255, 255, 0.7);
}

.theme-btn:hover {
    background: rgba(255, 255, 255, 0.1);
    transform: scale(1.1);
}

.theme-btn.active {
    background: rgba(255, 255, 255, 0.2);
    color: #fff;
    box-shadow: 0 0 15px rgba(255, 255, 255, 0.3);
}

.help-btn {
    position: absolute;
    right: 0;
    background: #ffd700;
    color: #333;
    border: none;
    padding: 8px 12px;
    border-radius: 50%;
    cursor: pointer;
    font-weight: bold;
    transition: all 0.3s ease;
}

.help-btn:hover {
    transform: scale(1.1);
    box-shadow: 0 0 15px rgba(255, 215, 0, 0.6);
}

.frame-section {
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(10px);
    border-radius: 20px;
    padding: 20px;
    margin-bottom: 20px;
    border: 1px solid rgba(255, 255, 255, 0.2);
}

.main-layout {
    display: grid;
    grid-template-columns: 1fr 400px;
    gap: 20px;
    margin-bottom: 20px;
}

.cards-section {
    display: flex;
    flex-direction: column;
}

.actions-section {
    display: flex;
    flex-direction: column;
}

.frame-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    margin-bottom: 20px;
}

.reading-popup {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.8);
    backdrop-filter: blur(10px);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 1000;
    animation: fadeIn 0.3s ease;
}

.reading-popup.show {
    display: flex;
}

.popup-content {
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(20px);
    border: 2px solid rgba(255, 215, 0, 0.3);
    border-radius: 20px;
    padding: 30px;
    max-width: 800px;
    max-height: 80vh;
    overflow-y: auto;
    position: relative;
    animation: popupAppear 0.4s ease;
}

.popup-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
}

.popup-header h3 {
    color: #ffd700;
    font-size: 1.5em;
    margin: 0;
}

.close-popup {
    background: rgba(255, 107, 107, 0.8);
    border: none;
    color: white;
    width: 30px;
    height: 30px;
    border-radius: 50%;
    cursor: pointer;
    font-size: 1.2em;
    font-weight: bold;
    transition: all 0.3s ease;
}

.close-popup:hover {
    background: rgba(255, 107, 107, 1);
    transform: scale(1.1);
}

.popup-cards {
    margin-bottom: 20px;
}

.popup-card {
    background: linear-gradient(145deg, #667eea, #764ba2);
    border: 2px solid #4ecdc4;
    border-radius: 15px;
    padding: 20px;
    margin-bottom: 15px;
    color: white;
    cursor: pointer;
    transition: all 0.3s ease;
    animation: cardSlideIn 0.5s ease;
}

.popup-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 10px 20px rgba(255, 215, 0, 0.3);
}

.popup-card.clarification {
    border-color: #ff6b6b;
    background: linear-gradient(145deg, #ff6b6b, #ee5a52);
}

.popup-card h4 {
    color: #ffd700;
    margin-bottom: 10px;
    font-size: 1.2em;
}

.popup-actions {
    display: flex;
    gap: 10px;
    justify-content: center;
    flex-wrap: wrap;
}

.popup-btn {
    background: linear-gradient(145deg, #4ecdc4, #44a08d);
    border: none;
    color: white;
    padding: 10px 20px;
    border-radius: 15px;
    cursor: pointer;
    font-weight: bold;
    transition: all 0.3s ease;
}

.popup-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 16px rgba(78, 205, 196, 0.4);
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

@keyframes popupAppear {
    from { 
        opacity: 0; 
        transform: scale(0.7) translateY(-50px); 
    }
    to { 
        opacity: 1; 
        transform: scale(1) translateY(0); 
    }
}

@keyframes cardSlideIn {
    from { 
        opacity: 0; 
        transform: translateX(-30px); 
    }
    to { 
        opacity: 1; 
        transform: translateX(0); 
    }
}

.frame-section h3 {
    color: #ffd700;
    margin-bottom: 15px;
    text-align: center;
    font-size: 1.1em;
}

.topic-selection {
    display: flex;
    flex-direction: column;
    gap: 10px;
    align-items: center;
}

.topic-btn {
    background: linear-gradient(145deg, #667eea, #764ba2);
    border: none;
    color: white;
    padding: 12px 25px;
    border-radius: 25px;
    cursor: pointer;
    font-weight: bold;
    transition: all 0.3s ease;
    font-size: 0.9em;
    min-width: 100px;
    width: 100%;
    max-width: 150px;
}

.topic-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 20px rgba(102, 126, 234, 0.4);
}

.topic-btn.selected {
    background: linear-gradient(145deg, #ffd700, #ffed2e);
    color: #333;
}

.action-buttons {
    display: flex;
    flex-direction: column;
    gap: 10px;
    align-items: center;
}

.action-btn {
    background: linear-gradient(145deg, #4ecdc4, #44a08d);
    border: none;
    color: white;
    padding: 12px 20px;
    border-radius: 20px;
    cursor: pointer;
    font-weight: bold;
    transition: all 0.3s ease;
    font-size: 0.9em;
    width: 100%;
    max-width: 150px;
}

.action-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 16px rgba(78, 205, 196, 0.4);
}

.manual-mode-btn {
    background: linear-gradient(145deg, #ff9500, #ff7b00);
    font-size: 0.85em;
    max-width: 170px;
    display: none;
}

.manual-mode-btn:hover {
    box-shadow: 0 8px 16px rgba(255, 149, 0, 0.4);
}

.manual-mode-btn.active {
    background: linear-gradient(145deg, #28a745, #20c997);
}

.interpretation-area {
    background: rgba(255, 255, 255, 0.05);
    backdrop-filter: blur(15px);
    border: 2px solid rgba(255, 215, 0, 0.3);
    border-radius: 20px;
    padding: 20px;
    margin-bottom: 20px;
    min-height: 200px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
}

.interpretation-actions {
    margin-top: 15px;
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
    justify-content: center;
}

.interp-btn {
    background: linear-gradient(145deg, #ff6b6b, #ee5a52);
    border: none;
    color: white;
    padding: 8px 15px;
    border-radius: 15px;
    cursor: pointer;
    font-weight: bold;
    transition: all 0.3s ease;
    font-size: 0.85em;
}

.interp-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 16px rgba(255, 107, 107, 0.4);
}

.interpretation-content {
    text-align: center;
    color: #a8a8a8;
    font-style: italic;
}

.reading-display {
    margin-top: 15px;
    display: flex;
    flex-wrap: wrap;
    gap: 15px;
    justify-content: center;
}

.reading-card {
    background: linear-gradient(145deg, #667eea, #764ba2);
    border: 2px solid #4ecdc4;
    border-radius: 10px;
    padding: 15px;
    color: white;
    font-weight: bold;
    min-width: 120px;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s ease;
    animation: cardAppear 0.5s ease;
}

.reading-card:hover {
    transform: translateY(-5px) scale(1.05);
    box-shadow: 0 15px 30px rgba(255, 215, 0, 0.4);
}

.reading-card.need-clarification {
    border-color: #ff6b6b;
    background: linear-gradient(145deg, #ff6b6b, #ee5a52);
}

@keyframes cardAppear {
    from { opacity: 0; transform: translateY(20px) rotateY(-90deg); }
    to { opacity: 1; transform: translateY(0) rotateY(0deg); }
}

.cards-area {
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(10px);
    border-radius: 20px;
    padding: 20px;
    margin-bottom: 20px;
    border: 1px solid rgba(255, 255, 255, 0.2);
}

.cards-title {
    color: #ffd700;
    margin-bottom: 15px;
    text-align: center;
    font-size: 1.2em;
}

.deck-container-large {
    position: relative;
    width: 100%;
    height: 600px;
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
    margin-bottom: 20px;
    border: 2px solid rgba(255, 215, 0, 0.2);
    border-radius: 15px;
    background: rgba(0, 0, 0, 0.1);
    padding: 15px;
}

.help-popup {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.8);
    backdrop-filter: blur(10px);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 1000;
    animation: fadeIn 0.3s ease;
}

.help-popup.show {
    display: flex;
}

.help-content {
    max-height: 400px;
    overflow-y: auto;
}

.help-item {
    margin-bottom: 20px;
    padding: 15px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 10px;
    border-left: 4px solid #ffd700;
}

.help-item h4 {
    color: #ffd700;
    margin-bottom: 8px;
    font-size: 1.1em;
}

.help-item p {
    line-height: 1.5;
    color: #e0e0e0;
}

.deck-cards {
    position: relative;
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
}

.wide-arc-card {
    position: absolute;
    width: 45px;
    height: 65px;
    background: linear-gradient(145deg, #2c3e50, #34495e);
    border: 2px solid #ffd700;
    border-radius: 8px;
    font-size: 1.5em;
    color: #ffd700;
    cursor: pointer;
    transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    transform-origin: center;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
    user-select: none;
}

.wide-arc-card::before {
    content: '';
    position: absolute;
    top: 2px;
    left: 2px;
    right: 2px;
    bottom: 2px;
    background: linear-gradient(145deg, #34495e, #2c3e50);
    border-radius: 6px;
    z-index: -1;
}

.wide-arc-card:hover {
    transform: scale(1.3) translateY(-10px);
    color: #ffffff;
    border-color: #ffffff;
    box-shadow: 0 15px 30px rgba(255, 215, 0, 0.4);
    z-index: 100;
    background: linear-gradient(145deg, #667eea, #764ba2);
}

.wide-arc-card.selectable {
    border-color: #00ff88;
    color: #00ff88;
    animation: cardPulse 2s infinite;
    box-shadow: 0 0 20px rgba(0, 255, 136, 0.5);
}

@keyframes cardPulse {
    0%, 100% { 
        box-shadow: 0 0 20px rgba(0, 255, 136, 0.5);
        transform: scale(1);
    }
    50% { 
        box-shadow: 0 0 30px rgba(0, 255, 136, 0.8);
        transform: scale(1.05);
    }
}

.wide-arc-card.selected {
    border-color: #ff6b6b;
    color: #ff6b6b;
    transform: scale(1.2);
    animation: selectedPulse 1s infinite alternate;
    box-shadow: 0 0 25px rgba(255, 107, 107, 0.7);
    background: linear-gradient(145deg, #ff6b6b, #ee5a52);
}

@keyframes selectedPulse {
    0% { 
        box-shadow: 0 0 25px rgba(255, 107, 107, 0.7);
        border-color: #ff6b6b;
    }
    100% { 
        box-shadow: 0 0 35px rgba(255, 107, 107, 1);
        border-color: #ffffff;
    }
}

.drawn-area {
    display: grid;
    grid-template-columns: 1fr auto;
    gap: 20px;
    align-items: center;
}

.drawn-cards {
    background: rgba(0, 0, 0, 0.2);
    border-radius: 15px;
    padding: 15px;
    min-height: 80px;
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    align-items: center;
}

.drawn-card {
    width: 35px;
    height: 45px;
    background: none;
    border: 1px solid rgba(255, 107, 107, 0.4);
    border-radius: 4px;
    color: #fff;
    font-size: 1.5em;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
}

.drawn-card:hover {
    border-color: #ff3838;
    box-shadow: 0 0 10px rgba(255, 56, 56, 0.6);
    transform: scale(1.1);
    background: rgba(255, 107, 107, 0.1);
}

.deck-actions {
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.deck-btn {
    background: linear-gradient(145deg, #764ba2, #667eea);
    border: none;
    color: white;
    padding: 10px 15px;
    border-radius: 15px;
    cursor: pointer;
    font-weight: bold;
    transition: all 0.3s ease;
    font-size: 0.85em;
    white-space: nowrap;
}

.deck-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 16px rgba(118, 75, 162, 0.4);
}

.status {
    text-align: center;
    padding: 15px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 15px;
    margin: 20px 0;
    font-style: italic;
    border: 1px solid rgba(255, 255, 255, 0.2);
}

.cards-remaining {
    color: #4ecdc4;
    font-weight: bold;
    background: rgba(78, 205, 196, 0.1);
    padding: 5px 10px;
    border-radius: 15px;
    display: inline-block;
    margin-bottom: 10px;
}

.mode-indicator {
    text-align: center;
    padding: 10px;
    background: rgba(255, 215, 0, 0.1);
    border-radius: 10px;
    margin: 10px 0;
    font-weight: bold;
    display: none;
    border: 1px solid rgba(255, 215, 0, 0.3);
}

.mode-indicator.show {
    display: block;
}

@media (max-width: 768px) {
    .header {
        flex-direction: column;
        gap: 15px;
    }
    
    .theme-switcher {
        position: static;
    }
    
    .help-btn {
        position: static;
    }
    
    .main-layout {
        grid-template-columns: 1fr;
        gap: 15px;
    }
    
    .actions-section {
        order: -1;
    }
    
    .action-buttons {
        flex-direction: column;
        align-items: center;
    }
    
    .title {
        font-size: 2em;
    }
    
    .popup-content {
        margin: 20px;
        max-height: 90vh;
        padding: 20px;
    }
}
</style>
</head>
<body>
<div class="stars" id="stars"></div>
<div class="container">
    <header class="header">
        <h1 class="title">⋅˚₊‧ ୨୧ Mystical Tarot ୨୧ ‧₊˚⋅</h1>
        <div class="theme-switcher">
            <button class="theme-btn active" data-theme="default" onclick="switchTheme('default')">🌙</button>
            <button class="theme-btn" data-theme="love" onclick="switchTheme('love')">💖</button>
            <button class="theme-btn" data-theme="career" onclick="switchTheme('career')">⭐</button>
        </div>
        <button class="help-btn" onclick="getHelp()">?</button>
    </header>

    <div class="main-layout">
        <div class="cards-section">
            <div class="cards-area">
                <h3 class="cards-title">Cards!</h3>
                <div class="cards-remaining">Cards: <span id="cardsLeft">78</span></div>
                <div class="deck-container-large">
                    <div class="deck-cards" id="deckCards"></div>
                </div>
                <div class="deck-actions">
                    <button class="deck-btn" onclick="shuffleDeck()">Shuffle Deck</button>
                </div>
            </div>
        </div>
        
        <div class="actions-section">
            <div class="frame-section">
                <h3>🔮 Selected Cards & Actions</h3>
                <div class="drawn-cards" id="drawnCards">
                    <p style="color: #a8a8a8; font-style: italic;">Select cards from deck...</p>
                </div>
                <div class="action-buttons" style="margin-top: 15px;">
                    <button class="action-btn" onclick="interpretSelected()">Read Cards</button>
                    <button class="action-btn" onclick="randomReading()">Random Reading</button>
                    <button class="action-btn" onclick="returnCards()" style="display: none;" id="returnBtn">Return All Cards</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Help Popup -->
    <div class="help-popup" id="helpPopup">
        <div class="popup-content">
            <div class="popup-header">
                <h3>💫 How to Use Mystical Tarot</h3>
                <button class="close-popup" onclick="closeHelpPopup()">×</button>
            </div>
            <div class="help-content">
                <div class="help-item">
                    <h4>🎭 Theme Switcher</h4>
                    <p>Use the buttons at the top: 🌙 Default, 💖 Love, ⭐ Career themes with different visual effects!</p>
                </div>
                <div class="help-item">
                    <h4>🃏 Selecting Cards</h4>
                    <p>Click cards from the deck to select them. Selected cards will move to the right panel and glow red.</p>
                </div>
                <div class="help-item">
                    <h4>🔮 Getting Readings</h4>
                    <p><strong>Read Cards:</strong> Interpret your selected cards<br>
                    <strong>Random Reading:</strong> Auto-select random cards and theme</p>
                </div>
                <div class="help-item">
                    <h4>✨ In the Reading Popup</h4>
                    <p>Click individual cards for specific clarification, or use "Need Clarification" for general guidance.</p>
                </div>
                <div class="help-item">
                    <h4>🔄 Managing Cards</h4>
                    <p><strong>Return All Cards:</strong> Put all cards back to deck<br>
                    <strong>Shuffle Deck:</strong> Randomize card positions</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Reading Popup -->
    <div class="reading-popup" id="readingPopup">
        <div class="popup-content">
            <div class="popup-header">
                <h3>🔮 Your Reading</h3>
                <button class="close-popup" onclick="closeReadingPopup()">×</button>
            </div>
            <div class="popup-cards" id="popupCards"></div>
            <div class="popup-actions">
                <button class="popup-btn" onclick="addClarification()">Need Clarification?</button>
                <button class="popup-btn" onclick="closeReadingPopup()">Close Reading</button>
            </div>
        </div>
    </div>

    <div class="interpretation-area" id="interpretationArea">
        <div class="interpretation-content" id="interpretationContent">
            <p>Click cards from the deck to select them, then click "Read Cards" to get your interpretation. Or use "Random Reading" for automatic selection.</p>
        </div>
        <div class="reading-display" id="readingDisplay"></div>
    </div>

    <div class="mode-indicator" id="modeIndicator" style="display: none;">
    </div>

    <div class="status" id="status">
        Welcome to Mystical Tarot! Choose a reading type to begin.
    </div>
</div>

<script>
const tarotDeck = [
    { name: "The Fool", group: "major", number: 0 },
    { name: "The Magician", group: "major", number: 1 },
    { name: "The High Priestess", group: "major", number: 2 },
    { name: "The Empress", group: "major", number: 3 },
    { name: "The Emperor", group: "major", number: 4 },
    { name: "The Hierophant", group: "major", number: 5 },
    { name: "The Lovers", group: "major", number: 6 },
    { name: "The Chariot", group: "major", number: 7 },
    { name: "Strength", group: "major", number: 8 },
    { name: "The Hermit", group: "major", number: 9 },
    { name: "Wheel of Fortune", group: "major", number: 10 },
    { name: "Justice", group: "major", number: 11 },
    { name: "The Hanged Man", group: "major", number: 12 },
    { name: "Death", group: "major", number: 13 },
    { name: "Temperance", group: "major", number: 14 },
    { name: "The Devil", group: "major", number: 15 },
    { name: "The Tower", group: "major", number: 16 },
    { name: "The Star", group: "major", number: 17 },
    { name: "The Moon", group: "major", number: 18 },
    { name: "The Sun", group: "major", number: 19 },
    { name: "Judgement", group: "major", number: 20 },
    { name: "The World", group: "major", number: 21 }
];

// Add Minor Arcana
const suits = ['cups', 'wands', 'swords', 'pentacles'];
const numbers = ['Ace', '2', '3', '4', '5', '6', '7', '8', '9', '10', 'Page', 'Knight', 'Queen', 'King'];

suits.forEach(suit => {
    numbers.forEach((num, index) => {
        tarotDeck.push({
            name: `${num} of ${suit.charAt(0).toUpperCase() + suit.slice(1)}`,
            group: suit,
            number: index + 1
        });
    });
});

// Game state
let currentDeck = [...tarotDeck];
let drawnCards = [];
let currentReading = [];
let selectedTopic = 'general'; // Default to general
let selectedCards = [];

// Initialize the game
function initGame() {
    shuffleDeck();
    updateDisplay();
    createStars();
}

function createStars() {
    const starsContainer = document.getElementById('stars');
    for (let i = 0; i < 50; i++) {
        const star = document.createElement('div');
        star.className = 'star';
        star.style.left = Math.random() * 100 + '%';
        star.style.top = Math.random() * 100 + '%';
        star.style.width = Math.random() * 3 + 1 + 'px';
        star.style.height = star.style.width;
        star.style.animationDelay = Math.random() * 3 + 's';
        starsContainer.appendChild(star);
    }
}

function shuffleDeck() {
    currentDeck = [...tarotDeck];
    for (let i = currentDeck.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [currentDeck[i], currentDeck[j]] = [currentDeck[j], currentDeck[i]];
    }
    selectedCards = [];
    updateDisplay();
    updateStatus("Deck shuffled! ✨ Ready for your mystical reading.");
}

function switchTheme(theme) {
    const body = document.body;
    const buttons = document.querySelectorAll('.theme-btn');
    
    // Remove active class from all buttons
    buttons.forEach(btn => btn.classList.remove('active'));
    
    // Add active class to clicked button
    document.querySelector(`[data-theme="${theme}"]`).classList.add('active');
    
    // Remove all theme classes
    body.classList.remove('love-theme', 'career-theme');
    
    // Apply theme
    if (theme === 'love') {
        body.classList.add('love-theme');
        selectedTopic = 'love';
        createLoveParticles();
        updateStatus("Love theme activated! 💖 Click cards to explore matters of the heart ✨");
    } else if (theme === 'career') {
        body.classList.add('career-theme');
        selectedTopic = 'career';
        createStarParticles();
        updateStatus("Career theme activated! ⭐ Click cards to discover your professional path ✨");
    } else {
        selectedTopic = 'general';
        createStars();
        updateStatus("Default mystical theme activated! 🌙 Click cards for general life guidance ✨");
    }
}

function selectTopic(topic) {
    // This function is now replaced by switchTheme, but keep for compatibility
    switchTheme(topic);
}

function createLoveParticles() {
    const starsContainer = document.getElementById('stars');
    starsContainer.innerHTML = ''; // Clear existing stars
    
    // Create floating hearts
    for (let i = 0; i < 30; i++) {
        const heart = document.createElement('div');
        heart.innerHTML = '💖';
        heart.style.position = 'absolute';
        heart.style.left = Math.random() * 100 + '%';
        heart.style.top = Math.random() * 100 + '%';
        heart.style.fontSize = Math.random() * 20 + 10 + 'px';
        heart.style.animationDelay = Math.random() * 3 + 's';
        heart.style.animation = 'twinkle 3s infinite, float 6s infinite ease-in-out';
        heart.style.pointerEvents = 'none';
        starsContainer.appendChild(heart);
    }
}

function createStarParticles() {
    const starsContainer = document.getElementById('stars');
    starsContainer.innerHTML = ''; // Clear existing stars
    
    // Create golden stars
    for (let i = 0; i < 40; i++) {
        const star = document.createElement('div');
        star.innerHTML = '⭐';
        star.style.position = 'absolute';
        star.style.left = Math.random() * 100 + '%';
        star.style.top = Math.random() * 100 + '%';
        star.style.fontSize = Math.random() * 15 + 8 + 'px';
        star.style.animationDelay = Math.random() * 3 + 's';
        star.style.animation = 'twinkle 3s infinite, rotate 8s infinite linear';
        star.style.pointerEvents = 'none';
        starsContainer.appendChild(star);
    }
}

function selectCardFromDeck(cardIndex) {
    if (currentDeck.length === 0) return;
    
    const cardDivs = document.querySelectorAll('.wide-arc-card');
    const cardDiv = cardDivs[cardIndex];
    
    if (selectedCards.includes(cardIndex)) {
        // Deselect card - return to deck from drawn
        selectedCards = selectedCards.filter(i => i !== cardIndex);
        cardDiv.classList.remove('selected');
        
        // Remove from drawn cards if it was there
        const cardData = currentDeck[cardIndex];
        const drawnIndex = drawnCards.findIndex(c => c.name === cardData.name);
        if (drawnIndex !== -1) {
            drawnCards.splice(drawnIndex, 1);
        }
        
        updateStatus(`Card deselected and returned. ${selectedCards.length} cards selected.`);
    } else {
        // Select card - move to drawn immediately
        if (selectedCards.length >= 5) {
            updateStatus("Maximum 5 cards can be selected! ⚠️");
            return;
        }
        
        selectedCards.push(cardIndex);
        cardDiv.classList.add('selected');
        
        // Add to drawn cards immediately
        const cardData = currentDeck[cardIndex];
        drawnCards.push(cardData);
        
        updateStatus(`Card selected! ${selectedCards.length} cards selected. Click "Read Cards" when ready.`);
    }
    
    updateDrawnDisplay();
    updateCounters();
}

function interpretSelected() {
    if (selectedCards.length === 0) {
        updateStatus("Please select at least one card first! 🎯");
        return;
    }
    
    // Move selected cards to reading
    currentReading = [];
    const sortedIndices = [...selectedCards].sort((a, b) => b - a); // Sort in reverse to maintain indices
    
    sortedIndices.forEach(index => {
        const card = currentDeck.splice(index, 1)[0];
        currentReading.push(card);
        drawnCards.push(card);
    });
    
    selectedCards = [];
    
    updateDisplay();
    displayReading();
    updateStatus(`${currentReading.length}-card reading completed! 🔮`);
}

function randomReading() {
    // Random topic and random spread
    const topics = ['default', 'love', 'career'];
    const randomTheme = topics[Math.floor(Math.random() * topics.length)];
    
    // Switch to random theme
    switchTheme(randomTheme);

    const maxCards = Math.min(3, currentDeck.length);
    if (maxCards === 0) {
        updateStatus("No cards left in deck! Please shuffle or return cards.");
        return;
    }

    const spreadSize = Math.floor(Math.random() * maxCards) + 1;
    performRandomReading(spreadSize);
    
    const topicDisplay = selectedTopic === 'general' ? 'general life guidance' : selectedTopic;
    updateStatus(`Random reading: ${spreadSize} cards for ${topicDisplay}! 🎲✨`);
}

function performRandomReading(numberOfCards) {
    currentReading = [];
    selectedCards = [];
    
    for (let i = 0; i < numberOfCards; i++) {
        const card = currentDeck.pop();
        currentReading.push(card);
        drawnCards.push(card);
    }

    updateDisplay();
    displayReading();
}

async function displayReading() {
    const contentDiv = document.getElementById('interpretationContent');
    const displayDiv = document.getElementById('readingDisplay');
    
    contentDiv.innerHTML = '<p>🔮 Consulting the mystical energies...</p>';
    displayDiv.innerHTML = '';

    // Show action buttons
    document.getElementById('clarificationBtn').style.display = 'inline-block';
    document.getElementById('returnBtn').style.display = 'inline-block';

    // Show cards first
    currentReading.forEach((card, index) => {
        const cardDiv = document.createElement('div');
        cardDiv.className = 'reading-card';
        cardDiv.textContent = card.name;
        cardDiv.style.animationDelay = `${index * 0.3}s`;
        cardDiv.onclick = () => clarifyCard(index);
        cardDiv.title = "Click for clarification";
        displayDiv.appendChild(cardDiv);
    });

    // Then show interpretation
    setTimeout(async () => {
        const topicDisplay = selectedTopic === 'general' ? 'General Life Guidance' : 
                           selectedTopic.charAt(0).toUpperCase() + selectedTopic.slice(1);
        
        let interpretation = `<h4>Your ${topicDisplay} Reading:</h4>`;
        
        for (let i = 0; i < currentReading.length; i++) {
            const card = currentReading[i];
            const meaning = await getCardMeaning(card, selectedTopic);
            
            interpretation += `<div style="margin: 10px 0; padding: 15px; background: rgba(255, 215, 0, 0.1); border-left: 4px solid #ffd700; border-radius: 8px;">
                <h5 style="color: #ffd700; margin-bottom: 8px;">Card ${i + 1}: ${card.name}</h5>
                <p>${meaning}</p>
            </div>`;
        }

        contentDiv.innerHTML = interpretation;
    }, 1000);
}

function addClarification() {
    if (currentDeck.length === 0) {
        updateStatus("No more cards available for clarification!");
        return;
    }

    const clarificationCard = currentDeck.pop();
    drawnCards.push(clarificationCard);
    
    // Add clarification card to reading
    const cardDiv = document.createElement('div');
    cardDiv.className = 'reading-card need-clarification';
    cardDiv.textContent = `Clarification: ${clarificationCard.name}`;
    cardDiv.style.animationDelay = '0s';
    
    const displayDiv = document.getElementById('readingDisplay');
    displayDiv.appendChild(cardDiv);
    
    // Add clarification to interpretation
    getCardMeaning(clarificationCard, selectedTopic).then(meaning => {
        const contentDiv = document.getElementById('interpretationContent');
        const clarificationHtml = `<div style="margin: 10px 0; padding: 15px; background: rgba(255, 107, 107, 0.1); border-left: 4px solid #ff6b6b; border-radius: 8px;">
            <h5 style="color: #ff6b6b; margin-bottom: 8px;">Clarification Card:</h5>
            <p><strong>${clarificationCard.name}:</strong> ${meaning}</p>
        </div>`;
        
        contentDiv.innerHTML += clarificationHtml;
    });
    
    updateDisplay();
    updateStatus(`Clarification card drawn! 🌟`);
}

async function clarifyCard(cardIndex) {
    if (currentDeck.length === 0) {
        updateStatus("No more cards available for clarification!");
        return;
    }

    const clarificationCard = currentDeck.pop();
    drawnCards.push(clarificationCard);
    
    // Add clarification card to reading
    const cardDiv = document.createElement('div');
    cardDiv.className = 'reading-card need-clarification';
    cardDiv.textContent = `Clarification: ${clarificationCard.name}`;
    cardDiv.style.animationDelay = '0s';
    
    const displayDiv = document.getElementById('readingDisplay');
    displayDiv.appendChild(cardDiv);
    
    // Add clarification to interpretation
    const meaning = await getCardMeaning(clarificationCard, selectedTopic);
    const contentDiv = document.getElementById('interpretationContent');
    const clarificationHtml = `<div style="margin: 10px 0; padding: 15px; background: rgba(255, 107, 107, 0.1); border-left: 4px solid #ff6b6b; border-radius: 8px;">
        <h5 style="color: #ff6b6b; margin-bottom: 8px;">Clarification for "${currentReading[cardIndex].name}":</h5>
        <p><strong>${clarificationCard.name}:</strong> ${meaning}</p>
    </div>`;
    
    contentDiv.innerHTML += clarificationHtml;
    
    updateDisplay();
    updateStatus(`Clarification card drawn for "${currentReading[cardIndex].name}"! 🌟`);
}

async function getCardMeaning(card, topic) {
    // Enhanced interpretations with proper tarot meanings
    const generalMeanings = {
        "The Fool": "New beginnings, spontaneity, and taking a leap of faith. Trust your instincts and embrace the unknown.",
        "The Magician": "Manifestation, resourcefulness, and personal power. You have all the tools needed to succeed.",
        "The High Priestess": "Intuition, sacred knowledge, and inner wisdom. Listen to your subconscious mind.",
        "The Empress": "Fertility, femininity, and abundance. Creativity and nurturing energy surround you.",
        "The Emperor": "Authority, structure, and control. Take charge of your situation with confidence.",
        "The Hierophant": "Tradition, spiritual guidance, and conformity. Seek wisdom from established sources.",
        "The Lovers": "Love, harmony, and choices. An important decision regarding relationships awaits.",
        "The Chariot": "Victory, determination, and control. Move forward with confidence and willpower.",
        "Strength": "Inner strength, courage, and patience. You have the power to overcome any challenge.",
        "The Hermit": "Soul searching, introspection, and guidance. Look within for the answers you seek.",
        "Wheel of Fortune": "Good fortune, karma, and life cycles. Change and opportunity are coming.",
        "Justice": "Justice, fairness, and truth. Balance and accountability are needed in this situation.",
        "The Hanged Man": "Suspension, restriction, and letting go. Sometimes patience and surrender are required.",
        "Death": "Transformation, endings, and new beginnings. A major life change is occurring.",
        "Temperance": "Balance, moderation, and patience. Find harmony and the middle path.",
        "The Devil": "Bondage, materialism, and temptation. Examine what may be holding you back.",
        "The Tower": "Sudden upheaval, broken pride, and disaster. Expect unexpected changes.",
        "The Star": "Hope, spirituality, and renewal. Your wishes and dreams may come true.",
        "The Moon": "Illusion, fear, and anxiety. Not everything is as it seems - trust your intuition.",
        "The Sun": "Joy, success, and vitality. Happiness, achievement, and positive energy await.",
        "Judgement": "Judgement, rebirth, and inner calling. A second chance and spiritual awakening.",
        "The World": "Completion, accomplishment, and travel. Success, fulfillment, and achievement of goals."
    };

    let baseMeaning = generalMeanings[card.name];
    
    if (!baseMeaning) {
        // For minor arcana - more detailed meanings
        if (card.name.includes('Ace')) {
            baseMeaning = "New beginnings and pure potential in this area of life.";
        } else if (card.name.includes('2')) {
            baseMeaning = "Balance, partnerships, and choices that need to be made.";
        } else if (card.name.includes('3')) {
            baseMeaning = "Growth, creativity, and initial success in your endeavors.";
        } else if (card.name.includes('4')) {
            baseMeaning = "Stability, foundation, and the need for solid structure.";
        } else if (card.name.includes('5')) {
            baseMeaning = "Conflict, change, and challenges that lead to growth.";
        } else if (card.name.includes('6')) {
            baseMeaning = "Harmony, healing, and moving toward better times.";
        } else if (card.name.includes('7')) {
            baseMeaning = "Reflection, assessment, and spiritual development.";
        } else if (card.name.includes('8')) {
            baseMeaning = "Movement, progress, and mastery of skills.";
        } else if (card.name.includes('9')) {
            baseMeaning = "Near completion, wisdom gained, and approaching fulfillment.";
        } else if (card.name.includes('10')) {
            baseMeaning = "Completion of a cycle, culmination, and new beginnings ahead.";
        } else if (card.name.includes('Page')) {
            baseMeaning = "New learning, messages, and youthful energy in this area.";
        } else if (card.name.includes('Knight')) {
            baseMeaning = "Action, adventure, and dynamic movement toward goals.";
        } else if (card.name.includes('Queen')) {
            baseMeaning = "Mastery, intuition, and nurturing wisdom in this realm.";
        } else if (card.name.includes('King')) {
            baseMeaning = "Authority, mastery, and leadership in this domain.";
        }
        
        // Add suit-specific meanings
        if (card.group === 'cups') {
            baseMeaning += " This relates to emotions, relationships, love, and spiritual connections.";
        } else if (card.group === 'wands') {
            baseMeaning += " This concerns career, creativity, passion, and personal growth.";
        } else if (card.group === 'swords') {
            baseMeaning += " This involves thoughts, communication, conflict, and mental challenges.";
        } else if (card.group === 'pentacles') {
            baseMeaning += " This focuses on material matters, money, health, and practical concerns.";
        }
    }

    // Modify meaning based on topic
    let contextualMeaning = baseMeaning;
    if (topic === 'love') {
        contextualMeaning += " In matters of the heart, this suggests deep emotional growth and meaningful connections in your romantic life.";
    } else if (topic === 'career') {
        contextualMeaning += " In your professional life, this indicates opportunities for advancement, success, and career development.";
    } else {
        contextualMeaning += " This card brings general guidance for your life path and personal development journey.";
    }

    return contextualMeaning;
}

function returnCards() {
    if (drawnCards.length === 0) {
        updateStatus("No cards to return!");
        return;
    }
    
    // Return cards to deck and clear selections
    currentDeck.push(...drawnCards);
    drawnCards = [];
    currentReading = [];
    selectedCards = [];
    
    document.getElementById('interpretationContent').innerHTML = '<p>Click cards from the deck to select them, then click "Read Cards" to get your interpretation. Or use "Random Reading" for automatic selection.</p>';
    document.getElementById('readingDisplay').innerHTML = '';
    
    shuffleDeck();
    updateStatus("All cards returned to deck and shuffled! ✨");
}

function returnSpecificCard(cardIndex) {
    const card = drawnCards.splice(cardIndex, 1)[0];
    currentDeck.push(card);
    
    updateDisplay();
    updateStatus(`${card.name} returned to deck! 🃏`);
}

function getHelp() {
    updateStatus("💫 How to use: 1) Click cards from deck to select them 2) Click 'Read Cards' to interpret OR use 'Random Reading' 3) Topics are optional (Love/Career) 4) Click reading cards for clarification 5) Return cards anytime!");
}

function updateDisplay() {
    updateDeckDisplay();
    updateDrawnDisplay();
    updateCounters();
}

function updateDeckDisplay() {
    // Update deck display with scattered layout for all 78 cards
    const deckDiv = document.getElementById('deckCards');
    deckDiv.innerHTML = '';
    
    const totalCards = currentDeck.length;
    const containerWidth = deckDiv.parentElement.clientWidth - 30;
    const containerHeight = 600;
    
    currentDeck.forEach((card, index) => {
        const cardDiv = document.createElement('div');
        cardDiv.className = 'wide-arc-card';
        
        // Scattered/random positioning to fit all cards
        const cols = Math.ceil(Math.sqrt(totalCards * 1.3));
        const rows = Math.ceil(totalCards / cols);
        
        const col = index % cols;
        const row = Math.floor(index / cols);
        
        // Add some randomness to make it look more natural
        const randomOffsetX = (Math.random() - 0.5) * 20;
        const randomOffsetY = (Math.random() - 0.5) * 20;
        
        const cardSpacing = Math.min(45, (containerWidth - 100) / cols);
        const rowSpacing = Math.min(60, (containerHeight - 100) / rows);
        
        const x = col * cardSpacing + 50 + randomOffsetX;
        const y = row * rowSpacing + 50 + randomOffsetY;
        
        cardDiv.style.left = `${Math.max(10, Math.min(x, containerWidth - 55))}px`;
        cardDiv.style.top = `${Math.max(10, Math.min(y, containerHeight - 75))}px`;
        cardDiv.style.transform = `rotate(${(Math.random() - 0.5) * 30}deg)`;
        
        // Add card click functionality and selection state
        cardDiv.onclick = () => selectCardFromDeck(index);
        
        // Apply selection state
        if (selectedCards.includes(index)) {
            cardDiv.classList.add('selected');
        }
        
        cardDiv.textContent = '🃏';
        cardDiv.title = `${card.name} - Click to select`;
        deckDiv.appendChild(cardDiv);
    });
}

function updateDrawnDisplay() {
    const drawnDiv = document.getElementById('drawnCards');
    const returnBtn = document.getElementById('returnBtn');
    
    // Show/hide return button based on whether there are drawn cards
    if (drawnCards.length > 0) {
        returnBtn.style.display = 'inline-block';
    } else {
        returnBtn.style.display = 'none';
    }
    
    if (drawnCards.length === 0) {
        drawnDiv.innerHTML = '<p style="color: #a8a8a8; font-style: italic;">Select cards from deck...</p>';
    } else {
        drawnDiv.innerHTML = '';
        drawnCards.forEach((card, index) => {
            const cardDiv = document.createElement('div');
            cardDiv.className = 'drawn-card';
            
            // Determine emoji based on card type
            let emoji = '🃏';
            if (card.group === 'major') {
                emoji = '⭐';
            } else if (card.group === 'cups') {
                emoji = '🏆';
            } else if (card.group === 'wands') {
                emoji = '🔥';
            } else if (card.group === 'swords') {
                emoji = '⚔️';
            } else if (card.group === 'pentacles') {
                emoji = '💰';
            }
            
            cardDiv.textContent = emoji;
            cardDiv.title = `${card.name} - Selected`;
            drawnDiv.appendChild(cardDiv);
        });
    }
}

function updateCounters() {
    // Update counters
    document.getElementById('cardsLeft').textContent = currentDeck.length;
}

function updateStatus(message) {
    document.getElementById('status').textContent = message;
}

// Initialize the game when page loads
document.addEventListener('DOMContentLoaded', function() {
    initGame();
});
</script>
</body>
</html>